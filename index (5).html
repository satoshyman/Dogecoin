
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DOGE Cloud Mining Pro - All-in-One</title>
    
    <!-- Scripts & Dependencies -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adsgram.ai/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --tg-theme-bg-color: #020617;
            --tg-theme-text-color: #f8fafc;
        }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            user-select: none;
            overflow: hidden;
            margin: 0;
            padding: 0;
            touch-action: manipulation;
            height: 100vh;
            width: 100vw;
        }
        #root {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid #1e293b;
            border-top-color: #eab308;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        @media (max-height: 600px) {
            .mining-circle { transform: scale(0.8); margin: -20px 0; }
        }

        /* Interactive improvements */
        button {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .active-scale:active {
            transform: scale(0.95);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "vite": "https://esm.sh/vite@^7.3.1",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
</head>
<body>
    <div id="root">
        <div class="flex flex-col justify-center items-center h-screen bg-[#020617] text-yellow-500 gap-5">
            <div class="loader"></div>
            <div class="text-lg font-black tracking-widest uppercase">DOGE MINER PRO</div>
        </div>
    </div>

    <script type="text/babel" data-presets="react,typescript">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- CONSTANTS ---
        const Page = { Mining: 'mining', Tasks: 'tasks', Referrals: 'referrals', Wallet: 'wallet', Admin: 'admin' };

        const DEFAULT_SETTINGS = {
            miningRatePerSession: 5.0,
            sessionDurationMs: 4 * 60 * 60 * 1000,
            referralCommission: 10,
            referralRewardPerUser: 0.1,
            minWithdrawal: 100.0,
            withdrawalFee: 2.0,
            dailyGiftAmount: 1.0,
            adsgramBlockId: '3946',
            showAdOnMiningStart: true,
            adminBotToken: '',
            adminChatId: '',
            adminPassword: 'Ahmednnn3',
            tasks: [
                { id: 't1', title: 'Follow Doge on X', reward: 2.0, type: 'social', link: 'https://x.com/doge' },
                { id: 't2', title: 'Watch Reward Video', reward: 1.5, type: 'ad' }
            ]
        };

        // --- SHARED UI COMPONENTS ---

        const NavBtn = ({ active, label, icon, onClick }) => (
            <button 
                onClick={onClick} 
                className={`flex flex-col items-center gap-1 flex-1 py-2 rounded-2xl transition-all ${active ? 'text-yellow-500 scale-110' : 'text-slate-600 hover:text-slate-400 hover:bg-white/5 active:scale-90'}`}
            >
                <span className="text-xl">{icon}</span>
                <span className="text-[8px] font-black uppercase">{label}</span>
            </button>
        );

        const TabItem = ({ active, onClick, label }) => (
            <button 
                onClick={onClick} 
                className={`px-5 py-2 rounded-xl text-[10px] font-black transition-all whitespace-nowrap ${active ? 'bg-yellow-600 text-white shadow-lg shadow-yellow-600/20' : 'bg-slate-900 text-slate-500 border border-slate-800 hover:bg-slate-800 hover:border-slate-700 active:scale-95'}`}
            >
                {label}
            </button>
        );

        const AdminInput = ({ label, type, value, onChange, placeholder }) => (
            <div className="bg-slate-950 p-4 rounded-2xl border border-slate-800 transition-all focus-within:border-yellow-600/50 focus-within:shadow-[0_0_10px_rgba(234,179,8,0.05)]">
                <label className="text-[9px] text-slate-500 font-black block mb-2">{label}</label>
                <input 
                    type={type} 
                    placeholder={placeholder} 
                    value={value} 
                    onChange={(e) => onChange(e.target.value)} 
                    className="w-full bg-transparent text-sm font-bold text-yellow-500 outline-none placeholder:text-slate-700" 
                />
            </div>
        );

        // --- PAGES ---

        const MiningPage = ({ state, settings, onStart, onEnd, onClaimGift }) => {
            const [timeLeft, setTimeLeft] = useState(0);
            const [curEarnings, setCurEarnings] = useState(0);
            const [giftTime, setGiftTime] = useState(0);

            useEffect(() => {
                let interval;
                if (state.isMining && state.miningStartTime) {
                    interval = setInterval(() => {
                        const elapsed = Date.now() - state.miningStartTime;
                        const rem = settings.sessionDurationMs - elapsed;
                        if (rem <= 0) {
                            onEnd();
                            setTimeLeft(0);
                            setCurEarnings(0);
                        } else {
                            setTimeLeft(rem);
                            setCurEarnings((elapsed / settings.sessionDurationMs) * settings.miningRatePerSession);
                        }
                    }, 100);
                }
                return () => clearInterval(interval);
            }, [state.isMining, state.miningStartTime, settings, onEnd]);

            useEffect(() => {
                const itv = setInterval(() => {
                    const rem = 86400000 - (Date.now() - (state.lastGiftClaimedTime || 0));
                    setGiftTime(rem > 0 ? rem : 0);
                }, 1000);
                return () => clearInterval(itv);
            }, [state.lastGiftClaimedTime]);

            const formatTime = (ms) => {
                const h = Math.floor(ms / 3600000);
                const m = Math.floor((ms % 3600000) / 60000);
                const s = Math.floor((ms % 60000) / 1000);
                return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            };

            const progress = state.isMining ? ((settings.sessionDurationMs - timeLeft) / settings.sessionDurationMs) * 100 : 0;

            return (
                <div className="flex flex-col items-center gap-6 py-2 animate-fadeIn">
                    <div className="w-full bg-slate-900/60 p-4 rounded-3xl flex justify-between items-center border border-white/5 shadow-md">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-yellow-500/10 rounded-xl flex items-center justify-center text-xl">üéÅ</div>
                            <div>
                                <p className="text-[9px] font-black text-slate-500 uppercase">Daily Gift</p>
                                <p className="text-xs font-black text-white">{settings.dailyGiftAmount.toFixed(2)} <span className="text-yellow-500">DOGE</span></p>
                            </div>
                        </div>
                        <button 
                            onClick={onClaimGift} 
                            disabled={giftTime > 0} 
                            className={`px-6 py-2 rounded-xl text-[10px] font-black transition-all ${giftTime > 0 ? 'bg-slate-800 text-slate-500' : 'bg-yellow-600 text-white shadow-lg hover:bg-yellow-500 hover:shadow-yellow-600/30 active:scale-95'}`}
                        >
                            {giftTime > 0 ? formatTime(giftTime) : 'Claim'}
                        </button>
                    </div>

                    <div className="mining-circle relative w-72 h-72 flex items-center justify-center my-4">
                        <svg className="absolute inset-0 transform -rotate-90 w-full h-full">
                            <circle cx="50%" cy="50%" r="42%" fill="transparent" stroke="#1e293b" strokeWidth="6" />
                            <circle cx="50%" cy="50%" r="42%" fill="transparent" stroke="#eab308" strokeWidth="8" strokeDasharray="100 100" strokeDashoffset={100 - progress} pathLength="100" strokeLinecap="round" className="transition-all duration-300 ease-linear" />
                        </svg>
                        <div className={`relative w-48 h-48 rounded-full bg-slate-950 border-[4px] flex flex-col items-center justify-center transition-all duration-500 ${state.isMining ? 'border-yellow-500 shadow-[0_0_30px_rgba(234,179,8,0.2)]' : 'border-slate-800 opacity-60'}`}>
                            <img src="https://cryptologos.cc/logos/dogecoin-doge-logo.svg?v=040" className={`w-24 h-24 mb-1 ${state.isMining ? 'animate-spin' : ''}`} style={{ animationDuration: '6s' }} />
                            <p className="text-[9px] font-black text-slate-500 uppercase tracking-widest">{state.isMining ? 'Mining' : 'Idle'}</p>
                        </div>
                    </div>

                    <div className="w-full grid grid-cols-2 gap-4">
                        <div className="bg-slate-900/60 p-5 rounded-3xl border border-white/5 text-center hover:bg-slate-900/80 transition-colors">
                            <span className="text-[9px] text-slate-500 font-black uppercase block mb-1">Session Profit</span>
                            <p className="text-xl font-black text-white font-mono">{curEarnings.toFixed(4)}</p>
                        </div>
                        <div className="bg-slate-900/60 p-5 rounded-3xl border border-white/5 text-center hover:bg-slate-900/80 transition-colors">
                            <span className="text-[9px] text-slate-500 font-black uppercase block mb-1">Remaining</span>
                            <p className="text-xl font-black text-white font-mono">{formatTime(state.isMining ? timeLeft : settings.sessionDurationMs)}</p>
                        </div>
                    </div>

                    <button 
                        onClick={onStart} 
                        disabled={state.isMining} 
                        className={`w-full py-5 rounded-3xl text-lg font-black shadow-xl transition-all ${state.isMining ? 'bg-slate-800 text-slate-500 cursor-not-allowed' : 'bg-yellow-600 text-white hover:bg-yellow-500 hover:shadow-yellow-600/40 hover:scale-[1.01] active:scale-[0.98] shadow-yellow-600/20'}`}
                    >
                        {state.isMining ? 'Mining in progress...' : 'Start Mining'}
                    </button>
                </div>
            );
        };

        const TasksPage = ({ state, settings, onComplete }) => {
            const [loadingTask, setLoadingTask] = useState(null);

            const handleTask = async (task) => {
                setLoadingTask(task.id);
                if (task.type === 'ad') {
                    if (window.Adsgram) {
                        try {
                            const AdController = window.Adsgram.init({ blockId: settings.adsgramBlockId });
                            const result = await AdController.show();
                            if (result.done) onComplete(task.id, task.reward);
                        } catch (e) { alert("Failed to load ad"); }
                    } else {
                        onComplete(task.id, task.reward);
                    }
                } else {
                    if (task.link) window.open(task.link, '_blank');
                    setTimeout(() => onComplete(task.id, task.reward), 3000);
                }
                setLoadingTask(null);
            };

            return (
                <div className="flex flex-col gap-4 py-2 animate-fadeIn">
                    <h2 className="text-xl font-black text-yellow-500 text-center mb-2">Daily Tasks</h2>
                    {settings.tasks.map(task => {
                        const isCompleted = state.completedTasks.includes(task.id);
                        return (
                            <div key={task.id} className="bg-slate-900/60 p-4 rounded-2xl flex justify-between items-center border border-white/5 hover:bg-slate-900/90 transition-all hover:border-white/10">
                                <div>
                                    <h4 className="text-xs font-bold text-white">{task.title}</h4>
                                    <p className="text-[10px] text-green-400 font-black">+{task.reward.toFixed(2)} DOGE</p>
                                </div>
                                <button 
                                    disabled={isCompleted || loadingTask === task.id} 
                                    onClick={() => handleTask(task)} 
                                    className={`px-5 py-2 rounded-xl text-[10px] font-black transition-all ${isCompleted ? 'bg-slate-800 text-slate-500' : 'bg-yellow-600 text-white hover:bg-yellow-500 hover:scale-105 active:scale-95'}`}
                                >
                                    {isCompleted ? 'Done' : (loadingTask === task.id ? 'Verifying...' : 'Start')}
                                </button>
                            </div>
                        );
                    })}
                </div>
            );
        };

        const WalletPage = ({ state, settings, onUpdateAddress, onWithdraw }) => {
            const [val, setVal] = useState('');
            const [addr, setAddr] = useState(state.withdrawalAddress);
            
            const handleRequest = () => {
                const amount = parseFloat(val);
                if (!addr || addr.length < 10) return alert('Please enter a valid wallet address');
                if (isNaN(amount) || amount < settings.minWithdrawal) return alert(`Minimum withdrawal is ${settings.minWithdrawal} DOGE`);
                if (amount + settings.withdrawalFee > state.balance) return alert('Insufficient balance');
                onWithdraw(amount, addr);
                setVal('');
            };

            return (
                <div className="flex flex-col gap-5 py-2 animate-fadeIn no-scrollbar">
                    <div className="bg-gradient-to-br from-yellow-600 to-yellow-800 p-8 rounded-[2.5rem] shadow-xl text-center hover:brightness-105 transition-all">
                        <p className="text-[10px] font-black text-white/70 uppercase mb-1">Total Balance</p>
                        <h2 className="text-4xl font-black text-white font-mono">{state.balance.toFixed(4)} <span className="text-sm opacity-50">DOGE</span></h2>
                    </div>

                    <div className="bg-slate-900 p-6 rounded-[2.5rem] space-y-4 border border-white/5">
                        <div className="space-y-2">
                            <label className="text-[9px] text-slate-500 font-black mr-2 uppercase">Wallet Address</label>
                            <input 
                                type="text" 
                                placeholder="DOGE Wallet Address" 
                                value={addr} 
                                onChange={e => {setAddr(e.target.value); onUpdateAddress(e.target.value);}} 
                                className="w-full bg-slate-950 border border-slate-800 rounded-2xl py-3.5 px-5 text-xs text-yellow-500 font-mono outline-none focus:border-yellow-600 transition-all shadow-inner placeholder:text-slate-800" 
                            />
                        </div>
                        <div className="space-y-2">
                            <label className="text-[9px] text-slate-500 font-black mr-2 uppercase">Withdrawal Amount</label>
                            <div className="relative">
                                <input 
                                    type="number" 
                                    placeholder="0.00" 
                                    value={val} 
                                    onChange={e => setVal(e.target.value)} 
                                    className="w-full bg-slate-950 border border-slate-800 rounded-2xl py-3.5 px-5 text-lg font-mono outline-none focus:border-yellow-600 transition-all shadow-inner" 
                                />
                                <button 
                                    onClick={() => setVal((state.balance - settings.withdrawalFee).toFixed(2))} 
                                    className="absolute right-3 top-1/2 -translate-y-1/2 px-3 py-1 bg-yellow-600/10 text-yellow-500 text-[10px] font-black rounded-lg hover:bg-yellow-600/20 transition-colors"
                                >
                                    MAX
                                </button>
                            </div>
                        </div>
                        <div className="bg-slate-950/50 p-3 rounded-xl text-[10px] font-bold text-slate-500 flex justify-between">
                            <span>Withdrawal Fee:</span>
                            <span className="text-white">{settings.withdrawalFee.toFixed(2)} DOGE</span>
                        </div>
                        <button 
                            onClick={handleRequest} 
                            className="w-full py-4 bg-yellow-600 rounded-2xl font-black text-sm hover:bg-yellow-500 hover:shadow-lg active:scale-95 transition-all"
                        >
                            Confirm Withdrawal Request
                        </button>
                    </div>

                    <div className="bg-slate-900 p-6 rounded-[2.5rem] border border-white/5 space-y-4 mb-20">
                        <h4 className="text-xs font-black text-white px-1">Withdrawal History</h4>
                        <div className="space-y-3">
                            {state.withdrawalHistory?.length > 0 ? (
                                state.withdrawalHistory.map(w => (
                                    <div key={w.id} className="bg-slate-950/50 p-4 rounded-2xl flex justify-between items-center border border-white/5">
                                        <div>
                                            <p className="text-xs font-black text-white">{w.amount} DOGE</p>
                                            <p className="text-[7px] text-slate-600 font-mono mt-1">{w.address.substring(0,25)}...</p>
                                        </div>
                                        <span className={`text-[8px] font-black px-3 py-1 rounded-full ${w.status === 'Completed' ? 'bg-green-500/10 text-green-500' : w.status === 'Rejected' ? 'bg-red-500/10 text-red-500' : 'bg-yellow-500/10 text-yellow-500'}`}>
                                            {w.status === 'Processing' ? 'Processing' : w.status === 'Completed' ? 'Completed' : 'Rejected'}
                                        </span>
                                    </div>
                                ))
                            ) : (
                                <p className="text-center py-6 text-[10px] text-slate-600 font-bold opacity-30">No transaction history</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ReferralPage = ({ state, settings }) => {
            const link = `https://t.me/share/url?url=https://t.me/your_bot?start=${state.userId}&text=DOGE_MINER_PRO_START`;
            const shareLink = `https://t.me/share/url?url=${link}&text=DOGE_MINER_PRO_START`;

            return (
                <div className="flex flex-col gap-5 py-2 animate-fadeIn no-scrollbar">
                    <div className="grid grid-cols-2 gap-3">
                        <div className="bg-slate-900 p-5 rounded-[1.8rem] border border-yellow-500/10 text-center hover:bg-slate-800/50 transition-colors">
                            <p className="text-[8px] font-black text-slate-500 uppercase mb-1">Total Referrals</p>
                            <h2 className="text-2xl font-black text-white">{state.referralsCount || 0}</h2>
                        </div>
                        <div className="bg-slate-900 p-5 rounded-[1.8rem] border border-green-500/10 text-center hover:bg-slate-800/50 transition-colors">
                            <p className="text-[8px] font-black text-slate-500 uppercase mb-1">Referral Earnings</p>
                            <h2 className="text-2xl font-black text-green-500">{(state.referralEarnings || 0).toFixed(2)}</h2>
                        </div>
                    </div>
                    
                    <div className="bg-gradient-to-r from-yellow-600/20 to-transparent p-6 rounded-[2rem] border border-yellow-600/30">
                        <h3 className="text-xs font-black text-yellow-500 mb-1">Earn {settings.referralRewardPerUser} DOGE Instantly!</h3>
                        <p className="text-[10px] text-slate-400 font-bold leading-relaxed">For every friend who joins via your link, you'll receive an instant reward plus {settings.referralCommission}% of their mining profits for life.</p>
                    </div>

                    <div className="bg-slate-900 p-6 rounded-[2rem] space-y-4 border border-white/5">
                        <p className="text-[10px] text-slate-500 font-bold text-center">Your Invitation Link</p>
                        <div className="bg-slate-950 p-4 rounded-xl border border-slate-800 text-[9px] font-mono text-yellow-500 break-all text-center select-all transition-colors hover:border-slate-700">{link}</div>
                        <button onClick={() => window.open(shareLink)} className="w-full py-4 bg-yellow-600 rounded-2xl font-black text-sm shadow-lg hover:bg-yellow-500 hover:scale-[1.02] active:scale-95 transition-all">Invite a Friend üöÄ</button>
                    </div>

                    <div className="bg-slate-900 p-6 rounded-[2rem] border border-white/5 space-y-4 mb-20">
                        <h4 className="text-xs font-black text-white">Active Friends</h4>
                        <div className="space-y-2 max-h-48 overflow-y-auto no-scrollbar">
                            {state.friends?.length > 0 ? (
                                state.friends.map((f, idx) => (
                                    <div key={idx} className="bg-slate-950/50 p-4 rounded-2xl flex justify-between items-center border border-white/5">
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-xs">üë§</div>
                                            <p className="text-[10px] font-bold text-white">{f.name}</p>
                                        </div>
                                        <p className="text-[10px] font-black text-green-500">+{settings.referralRewardPerUser} DOGE</p>
                                    </div>
                                ))
                            ) : (
                                <div className="py-10 text-center opacity-30 text-[10px] font-bold">No friends joined yet</div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const AdminDashboard = ({ settings, onSaveSettings, userState, onUpdateWithdrawal, onClose }) => {
            const [activeTab, setActiveTab] = useState('finance');
            const [localSettings, setLocalSettings] = useState(settings);

            const handleSave = () => {
                onSaveSettings(localSettings);
                alert('‚úÖ Settings saved successfully');
            };

            const testAd = async () => {
                if (window.Adsgram) {
                    try {
                        const AdController = window.Adsgram.init({ blockId: localSettings.adsgramBlockId });
                        await AdController.show();
                    } catch (e) { alert("Ad failed to show. Check Block ID"); }
                }
            };

            return (
                <div className="fixed inset-0 bg-slate-950 z-[250] flex flex-col p-5 overflow-hidden animate-fadeIn">
                    <div className="flex justify-between items-center mb-6 bg-slate-900 p-5 rounded-[2rem] border border-slate-800 shadow-xl">
                        <h2 className="text-lg font-black text-yellow-500">Admin Panel</h2>
                        <button onClick={onClose} className="p-3 bg-slate-800 rounded-2xl text-slate-400 hover:text-white active:scale-90 transition-all">‚ùå</button>
                    </div>

                    <div className="flex gap-2 mb-6 overflow-x-auto no-scrollbar pb-2 shrink-0">
                        <TabItem active={activeTab === 'finance'} onClick={() => setActiveTab('finance')} label="Finance" />
                        <TabItem active={activeTab === 'tasks'} onClick={() => setActiveTab('tasks')} label="Tasks" />
                        <TabItem active={activeTab === 'withdrawals'} onClick={() => setActiveTab('withdrawals')} label="Withdrawals" />
                        <TabItem active={activeTab === 'users'} onClick={() => setActiveTab('users')} label="Users" />
                        <TabItem active={activeTab === 'bot'} onClick={() => setActiveTab('bot')} label="Bot & Ads" />
                    </div>

                    <div className="flex-1 overflow-y-auto space-y-6 pb-24 no-scrollbar">
                        {activeTab === 'finance' && (
                            <div className="space-y-4">
                                <AdminInput label="Mining Rate (DOGE)" type="number" value={localSettings.miningRatePerSession} onChange={v => setLocalSettings({...localSettings, miningRatePerSession: parseFloat(v)})} />
                                <AdminInput label="Session Duration (minutes)" type="number" value={localSettings.sessionDurationMs/60000} onChange={v => setLocalSettings({...localSettings, sessionDurationMs: parseFloat(v)*60000})} />
                                <AdminInput label="Min Withdrawal" type="number" value={localSettings.minWithdrawal} onChange={v => setLocalSettings({...localSettings, minWithdrawal: parseFloat(v)})} />
                                <AdminInput label="Withdrawal Fee" type="number" value={localSettings.withdrawalFee} onChange={v => setLocalSettings({...localSettings, withdrawalFee: parseFloat(v)})} />
                                <AdminInput label="Referral Reward" type="number" value={localSettings.referralRewardPerUser} onChange={v => setLocalSettings({...localSettings, referralRewardPerUser: parseFloat(v)})} />
                                <AdminInput label="Admin Password" type="text" value={localSettings.adminPassword} onChange={v => setLocalSettings({...localSettings, adminPassword: v})} />
                            </div>
                        )}

                        {activeTab === 'tasks' && (
                            <div className="space-y-4">
                                <button onClick={() => setLocalSettings({...localSettings, tasks: [...localSettings.tasks, {id: Date.now().toString(), title: 'New Task', reward: 1.0, type: 'social'}]})} className="w-full py-4 bg-yellow-600/10 text-yellow-500 rounded-2xl border border-yellow-500/20 font-black text-xs">+ Add Task</button>
                                {localSettings.tasks.map((task, idx) => (
                                    <div key={task.id} className="bg-slate-900 p-5 rounded-3xl border border-slate-800 space-y-3">
                                        <input className="w-full bg-slate-950 border border-slate-800 rounded-xl p-3 text-xs outline-none focus:border-yellow-600 transition-all" value={task.title} onChange={e => {
                                            const newTasks = [...localSettings.tasks];
                                            newTasks[idx].title = e.target.value;
                                            setLocalSettings({...localSettings, tasks: newTasks});
                                        }} />
                                        <div className="grid grid-cols-2 gap-2">
                                            <input type="number" className="bg-slate-950 border border-slate-800 rounded-xl p-3 text-xs outline-none focus:border-yellow-600 transition-all" value={task.reward} onChange={e => {
                                                const newTasks = [...localSettings.tasks];
                                                newTasks[idx].reward = parseFloat(e.target.value);
                                                setLocalSettings({...localSettings, tasks: newTasks});
                                            }} />
                                            <select className="bg-slate-950 border border-slate-800 rounded-xl p-3 text-xs outline-none focus:border-yellow-600 transition-all" value={task.type} onChange={e => {
                                                const newTasks = [...localSettings.tasks];
                                                newTasks[idx].type = e.target.value;
                                                setLocalSettings({...localSettings, tasks: newTasks});
                                            }}>
                                                <option value="ad">Adsgram</option>
                                                <option value="social">Social Link</option>
                                            </select>
                                        </div>
                                        {task.type !== 'ad' && (
                                            <input className="w-full bg-slate-950 border border-slate-800 rounded-xl p-3 text-xs outline-none focus:border-yellow-600 transition-all" placeholder="URL Link" value={task.link || ''} onChange={e => {
                                                const newTasks = [...localSettings.tasks];
                                                newTasks[idx].link = e.target.value;
                                                setLocalSettings({...localSettings, tasks: newTasks});
                                            }} />
                                        )}
                                        <button onClick={() => setLocalSettings({...localSettings, tasks: localSettings.tasks.filter(t => t.id !== task.id)})} className="text-red-500 text-[10px] font-bold hover:underline">üóëÔ∏è Delete Task</button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'withdrawals' && (
                            <div className="space-y-4">
                                {userState.withdrawalHistory?.length > 0 ? userState.withdrawalHistory.map(w => (
                                    <div key={w.id} className="bg-slate-900 p-5 rounded-3xl border border-slate-800 space-y-3">
                                        <div className="flex justify-between items-center">
                                            <span className="text-xs font-black text-white">{w.amount} DOGE</span>
                                            <span className={`text-[8px] px-2 py-1 rounded-md ${w.status === 'Processing' ? 'bg-yellow-500/10 text-yellow-500' : 'bg-green-500/10 text-green-500'}`}>{w.status}</span>
                                        </div>
                                        <p className="text-[8px] text-slate-500 break-all font-mono">{w.address}</p>
                                        <div className="flex gap-2 pt-2 border-t border-slate-800">
                                            <button onClick={() => onUpdateWithdrawal(w.id, 'Completed')} className="flex-1 py-2 bg-green-600 rounded-xl text-[10px] font-black hover:bg-green-500 transition-all">PAID</button>
                                            <button onClick={() => onUpdateWithdrawal(w.id, 'Rejected')} className="flex-1 py-2 bg-red-600 rounded-xl text-[10px] font-black hover:bg-red-500 transition-all">REJECT</button>
                                        </div>
                                    </div>
                                )) : <p className="text-center py-10 text-slate-600 text-xs">No pending withdrawals</p>}
                            </div>
                        )}

                        {activeTab === 'users' && (
                            <div className="bg-slate-900 p-6 rounded-[2rem] border border-slate-800 space-y-3">
                                <h4 className="text-sm font-black text-white mb-2">Member Statistics</h4>
                                <div className="space-y-3 text-[10px] font-bold">
                                    <div className="flex justify-between border-b border-slate-800 pb-2"><span className="text-slate-500">Username:</span><span className="text-white">{userState.username}</span></div>
                                    <div className="flex justify-between border-b border-slate-800 pb-2"><span className="text-slate-500">Balance:</span><span className="text-yellow-500">{userState.balance.toFixed(4)} DOGE</span></div>
                                    <div className="flex justify-between border-b border-slate-800 pb-2"><span className="text-slate-500">Referrals:</span><span className="text-white">{userState.referralsCount}</span></div>
                                    <div className="flex justify-between"><span className="text-slate-500">Address:</span><span className="text-white text-[8px]">{userState.withdrawalAddress || 'Not Registered'}</span></div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'bot' && (
                            <div className="space-y-4">
                                <div className="bg-yellow-600/10 p-4 rounded-2xl border border-yellow-600/20 mb-4">
                                    <h5 className="text-[10px] font-black text-yellow-500 uppercase mb-2">Adsgram Settings</h5>
                                    <AdminInput 
                                        label="Adsgram Block ID" 
                                        type="text" 
                                        placeholder="Example: 3946"
                                        value={localSettings.adsgramBlockId} 
                                        onChange={v => setLocalSettings({...localSettings, adsgramBlockId: v})} 
                                    />
                                    <div className="flex justify-between items-center mt-3 bg-slate-900 p-3 rounded-xl border border-slate-800">
                                        <label className="text-[9px] text-slate-500 font-black">Show ad on Mining Start</label>
                                        <input type="checkbox" checked={localSettings.showAdOnMiningStart} onChange={e => setLocalSettings({...localSettings, showAdOnMiningStart: e.target.checked})} className="w-5 h-5 accent-yellow-500 cursor-pointer" />
                                    </div>
                                    <button onClick={testAd} className="w-full mt-3 py-2 bg-slate-800 rounded-xl text-[10px] font-black text-slate-400 hover:text-white border border-slate-700 active:scale-95 transition-all">üëÅÔ∏è Test Ad Display</button>
                                </div>

                                <div className="bg-slate-900 p-4 rounded-2xl border border-slate-800">
                                    <h5 className="text-[10px] font-black text-white uppercase mb-2">Telegram Notifications</h5>
                                    <AdminInput label="Bot Token" type="text" value={localSettings.adminBotToken} onChange={v => setLocalSettings({...localSettings, adminBotToken: v})} />
                                    <AdminInput label="Admin Chat ID" type="text" value={localSettings.adminChatId} onChange={v => setLocalSettings({...localSettings, adminChatId: v})} />
                                </div>
                                <div className="bg-blue-600/10 p-5 rounded-2xl border border-blue-600/20 text-[9px] text-blue-400 font-bold leading-relaxed">
                                    Put your Adsgram Block ID in the field above so ads appear to users and you earn from them.
                                </div>
                            </div>
                        )}

                        <button onClick={handleSave} className="w-full py-5 bg-yellow-600 rounded-3xl font-black text-white shadow-xl shadow-yellow-600/20 active:scale-95 transition-all hover:bg-yellow-500">Save Changes</button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [currentPage, setCurrentPage] = useState(Page.Mining);
            const [adminClickCount, setAdminClickCount] = useState(0);
            const [showAdminAuth, setShowAdminAuth] = useState(false);
            const [authPassword, setAuthPassword] = useState('');

            const tg = useMemo(() => window.Telegram?.WebApp, []);

            const [settings, setSettings] = useState(() => {
                const s = localStorage.getItem('doge_v11_s');
                return s ? JSON.parse(s) : DEFAULT_SETTINGS;
            });

            const [user, setUser] = useState(() => {
                const defaultU = {
                    balance: 0, miningStartTime: null, isMining: false, completedTasks: [],
                    withdrawalAddress: '', userId: Math.random().toString(36).substring(2, 9).toUpperCase(),
                    username: 'DOGE_USER', withdrawalHistory: [], lastGiftClaimedTime: null,
                    referralEarnings: 0, referralsCount: 0, friends: []
                };
                const u = localStorage.getItem('doge_v11_u');
                return u ? { ...defaultU, ...JSON.parse(u) } : defaultU;
            });

            useEffect(() => {
                localStorage.setItem('doge_v11_s', JSON.stringify(settings));
                localStorage.setItem('doge_v11_u', JSON.stringify(user));
            }, [settings, user]);

            useEffect(() => {
                if (tg) {
                    tg.ready();
                    tg.expand();
                    const tgUser = tg.initDataUnsafe?.user;
                    if (tgUser) setUser(p => ({ ...p, username: tgUser.username || tgUser.first_name || 'DOGE_USER' }));
                }
            }, [tg]);

            const haptic = (s = 'light') => tg?.HapticFeedback?.impactOccurred(s);

            const sendNotification = async (w) => {
                if (!settings.adminBotToken || !settings.adminChatId) return;
                const msg = `üí∞ *New Withdrawal Request*\n\nüë§ User: \`${user.username}\`\nüíµ Amount: \`${w.amount} DOGE\`\nüìç Wallet: \`${w.address}\``;
                try {
                    await fetch(`https://api.telegram.org/bot${settings.adminBotToken}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chat_id: settings.adminChatId, text: msg, parse_mode: 'Markdown' })
                    });
                } catch (e) { console.error("Notification Error", e); }
            };

            const handleWithdraw = (amount, address) => {
                haptic('heavy');
                const newW = { id: Date.now().toString(), amount, address, status: 'Processing', timestamp: Date.now() };
                setUser(p => ({
                    ...p, 
                    balance: p.balance - (amount + settings.withdrawalFee), 
                    withdrawalAddress: address, 
                    withdrawalHistory: [newW, ...p.withdrawalHistory]
                }));
                sendNotification(newW);
                alert('Withdrawal request submitted successfully');
            };

            const handleStartMining = async () => {
                haptic('medium');
                
                if (settings.showAdOnMiningStart) {
                    if (window.Adsgram) {
                        try {
                            const AdController = window.Adsgram.init({ blockId: settings.adsgramBlockId });
                            const result = await AdController.show();
                            if (!result.done) {
                                alert("You must watch the full ad to start mining!");
                                return;
                            }
                        } catch (e) { 
                            console.warn("Ad Failed or Blocked", e); 
                        }
                    }
                }
                
                setUser(p => ({ ...p, isMining: true, miningStartTime: Date.now() }));
            };

            const navigate = (p) => { haptic(); setCurrentPage(p); };

            return (
                <div className="flex flex-col h-full w-full bg-[#020617] text-white font-['Cairo'] select-none">
                    <header className="px-5 py-4 bg-slate-900/80 backdrop-blur-md flex justify-between items-center border-b border-white/5 sticky top-0 z-[100]">
                        <div className="flex items-center gap-2 cursor-pointer transition-transform active:scale-95" onClick={() => {
                            const newCount = adminClickCount + 1;
                            setAdminClickCount(newCount);
                            if (newCount >= 8) { setShowAdminAuth(true); setAdminClickCount(0); }
                        }}>
                            <img src="https://cryptologos.cc/logos/dogecoin-doge-logo.svg?v=040" className="w-8 h-8" alt="D" />
                            <span className="font-black text-yellow-500 text-base">DOGE PRO</span>
                        </div>
                        <div className="bg-slate-800/80 px-4 py-1.5 rounded-2xl text-yellow-500 text-[11px] font-black border border-yellow-500/20 shadow-sm transition-all hover:border-yellow-500/40">
                            {user.balance.toFixed(4)} <span className="opacity-50 text-[8px]">DOGE</span>
                        </div>
                    </header>

                    {showAdminAuth && (
                        <div className="fixed inset-0 z-[300] flex items-center justify-center p-6 bg-black/90 backdrop-blur-md animate-fadeIn">
                            <div className="bg-slate-900 p-8 rounded-[2.5rem] w-full max-w-sm border border-slate-800 text-center shadow-2xl">
                                <h3 className="text-xl font-black mb-6 text-yellow-500">Admin Login</h3>
                                <input 
                                    type="password" 
                                    placeholder="Enter Password" 
                                    value={authPassword} 
                                    onChange={e => setAuthPassword(e.target.value)} 
                                    className="w-full bg-slate-950 border border-slate-800 rounded-2xl py-4 px-5 text-center text-white mb-6 outline-none focus:border-yellow-600 transition-all placeholder:text-slate-800" 
                                />
                                <div className="space-y-3">
                                    <button 
                                        onClick={() => { 
                                            if(authPassword === settings.adminPassword) { navigate(Page.Admin); setShowAdminAuth(false); setAuthPassword(''); }
                                            else alert('Incorrect password!');
                                        }} 
                                        className="w-full py-4 bg-yellow-600 rounded-2xl font-black text-white shadow-lg hover:bg-yellow-500 active:scale-95 transition-all"
                                    >Login</button>
                                    <button onClick={() => setShowAdminAuth(false)} className="text-slate-500 text-xs font-bold hover:text-slate-400 transition-colors">Cancel</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <main className="flex-1 overflow-y-auto no-scrollbar px-5 pb-32 pt-2">
                        {currentPage === Page.Mining && <MiningPage state={user} settings={settings} onStart={handleStartMining} onEnd={() => setUser(p => ({ ...p, isMining: false, balance: p.balance + settings.miningRatePerSession, miningStartTime: null }))} onClaimGift={() => setUser(p => ({ ...p, balance: p.balance + settings.dailyGiftAmount, lastGiftClaimedTime: Date.now() }))} />}
                        {currentPage === Page.Tasks && <TasksPage state={user} settings={settings} onComplete={(id, r) => setUser(p => ({ ...p, balance: p.balance + r, completedTasks: [...p.completedTasks, id] }))} />}
                        {currentPage === Page.Referrals && <ReferralPage state={user} settings={settings} />}
                        {currentPage === Page.Wallet && <WalletPage state={user} settings={settings} onUpdateAddress={a => setUser(p => ({ ...p, withdrawalAddress: a }))} onWithdraw={handleWithdraw} />}
                        {currentPage === Page.Admin && <AdminDashboard settings={settings} onSaveSettings={setSettings} userState={user} onUpdateWithdrawal={(id, s) => setUser(p => ({ ...p, withdrawalHistory: p.withdrawalHistory.map(w => w.id === id ? { ...w, status: s } : w) }))} onClose={() => navigate(Page.Mining)} />}
                    </main>

                    {currentPage !== Page.Admin && (
                        <nav className="fixed bottom-6 left-6 right-6 bg-slate-900/90 backdrop-blur-xl border border-white/5 flex justify-around items-center p-3 rounded-[2.2rem] shadow-2xl z-[100]">
                            <NavBtn active={currentPage === Page.Mining} label="Mining" icon="‚õèÔ∏è" onClick={() => navigate(Page.Mining)} />
                            <NavBtn active={currentPage === Page.Tasks} label="Tasks" icon="üìã" onClick={() => navigate(Page.Tasks)} />
                            <NavBtn active={currentPage === Page.Referrals} label="Friends" icon="üë•" onClick={() => navigate(Page.Referrals)} />
                            <NavBtn active={currentPage === Page.Wallet} label="Wallet" icon="üí∞" onClick={() => navigate(Page.Wallet)} />
                        </nav>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
